C51 COMPILER V9.56.0.0   HTTP_AP                                                           07/23/2020 20:56:21 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE HTTP_AP
OBJECT MODULE PLACED IN .\Objects\http_ap.obj
COMPILER INVOKED BY: d:\Keil_v5\C51\BIN\C51.EXE APP\http_ap.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(.\STC_LIB;.\APP) DEB
                    -UG OBJECTEXTEND PRINT(.\Listings\http_ap.lst) TABS(2) OBJECT(.\Objects\http_ap.obj)

line level    source

   1          #include "http_ap.h"
   2          #include "wifi.h"
   3          #include "string.h"
   4          #include "debug.h"
   5          
   6          #define AP_MSG_KEYWORD  "+IPD,"
   7          
   8          u8 code HTTP_H1[]="HTTP/1.0 200 OK\r\n\
   9          Content-Type: text/html; charset=utf-8\r\n\
  10          Content-Length: ";
  11          
  12          u8 code HTTP_INDEX_CONTENT[]  = "<!DOCTYPE html>\r\n\
  13          <html lang=\"en\">\r\n\
  14          <head>\r\n\
  15              <meta charset=\"UTF-8\">\r\n\
  16              <title>Genius AI Lab</title>\r\n\
  17              <style>\r\n\
  18                  h1{font-size:600%;text-align:center}\r\n\
  19                  span{font-size:300%;margin-left:40px}\r\n\
  20                  button{type:button;margin-left:40px;width:120px;height:120px;border-radius:60px;padding:20px}\r\n\
  21                  .ss1{background:#ff9953}\r\n\
  22                  .ss2{background:darkgray}\r\n\
  23                  .ss3{background: #ffe0a0}\r\n\
  24                  .ss4{background: #d6d6d6}\r\n\
  25                  .ss5{border-radius:20px;height:60px}\r\n\
  26              </style>\r\n\
  27              <script>\r\n\
  28                  function jp(a)\r\n\
  29                  {window.location.href=\"/?\"+a}\r\n\
  30              </script>\r\n\
  31          </head>\r\n\
  32          <body>\r\n\
  33              <div style=\"width:1000px\">\r\n\
  34                  <div style=\"background-color:slategray\">\r\n\
  35                      <h1>Genius AI Lab</h1>\r\n\
  36                  </div>\r\n\
  37                  <br>\r\n\
  38                          <span>SWITCH1:</span>\r\n\
  39                          <button class=\"ss1\" onclick=\"jp('SWITCH1=ON')\">ON</button>\r\n\
  40                          <button class=\"ss2\" onclick=\"jp('SWITCH1=OFF')\">OFF</button>\r\n\
  41                          <br>\r\n\
  42                          <span>SWITCH2:</span>\r\n\
  43                          <button class=\"ss1\" onclick=\"jp('SWITCH2=ON')\">ON</button>\r\n\
  44                          <button class=\"ss2\" onclick=\"jp('SWITCH2=OFF')\">OFF</button><br>\r\n\
  45                          <span>SWITCH3:</span>\r\n\
  46                          <button class=\"ss1\" onclick=\"jp('SWITCH3=ON')\">ON</button>\r\n\
  47                          <button class=\"ss2\" onclick=\"jp('SWITCH3=OFF')\">OFF</button><br>\r\n\
  48                          <span>SWITCH4:</span>\r\n\
  49                          <button class=\"ss1\" onclick=\"jp('SWITCH4=ON')\">ON</button>\r\n\
  50                          <button class=\"ss2\" onclick=\"jp('SWITCH4=OFF')\">OFF</button>\r\n\
  51                  <br>\r\n\
  52              </div>\r\n\
  53          </body>\r\n\
  54          </html>";
C51 COMPILER V9.56.0.0   HTTP_AP                                                           07/23/2020 20:56:21 PAGE 2   

  55          
  56          void AP_MSG_Handle(void)
  57          {
  58   1        u8 *p, *temp;
  59   1        u8 client_id[2];
  60   1        debug("AP_MSG_Handle\r\n");
  61   1        temp = strstr(WIFI_RBUF, "HTTP");
  62   1        if(temp)
  63   1          *temp = 0x00;
  64   1        p = strstr(WIFI_RBUF, AP_MSG_KEYWORD);
  65   1        if(p)
  66   1        {
  67   2          p = p + sizeof(AP_MSG_KEYWORD)-1;
  68   2          debug_vip(p);
  69   2          client_id[0] = *p;
  70   2          client_id[1] = '\0';
  71   2          p = strstr(WIFI_RBUF, HTTP_REQUEST_INDEX);
  72   2          if(p)
  73   2          {
  74   3            http_send(client_id, HTTP_INDEX_CONTENT);
  75   3          }
  76   2          else
  77   2          {
  78   3            p = strstr(WIFI_RBUF, HTTP_REQUEST_CONTROL);
  79   3            if(p)
  80   3            {
  81   4              if(DevicesControl(p) == 1)
  82   4                http_send(client_id, HTTP_INDEX_CONTENT);
  83   4              else
  84   4                http_send(client_id, "Devices control Fail !!!");
  85   4            }
  86   3          }
  87   2        }
  88   1      }
  89          
  90          /**************************************************************************************
  91          u8 code HTTP_INDEX_CONTENT[]  = "<!DOCTYPE html>\r\n\
  92          <html lang=\"en\">\r\n\
  93          <head>\r\n\
  94              <meta charset=\"UTF-8\">\r\n\
  95              <title>Genius AI Lab</title>\r\n\
  96              <style>\r\n\
  97                  h1{font-size:600%;text-align:center}\r\n\
  98                  span{font-size:300%;margin-left:40px}\r\n\
  99                  button{type:button;margin-left:40px;width:120px;height:120px;border-radius:60px;padding:20px}\r\n\
 100                  .ss1{background:#ff9953}\r\n\
 101                  .ss2{background:darkgray}\r\n\
 102                  .ss3{background: #ffe0a0}\r\n\
 103                  .ss4{background: #d6d6d6}\r\n\
 104                  .ss5{border-radius:20px;height:60px}\r\n\
 105              </style>\r\n\
 106              <script>\r\n\
 107                  function jp(a)\r\n\
 108                  {window.location.href=\"/?\"+a}\r\n\
 109              </script>\r\n\
 110          </head>\r\n\
 111          <body>\r\n\
 112              <div style=\"width:1000px\">\r\n\
 113                  <div style=\"background-color:slategray\">\r\n\
 114                      <h1>Genius AI Lab</h1>\r\n\
 115                  </div>\r\n\
 116                  <br>\r\n\
C51 COMPILER V9.56.0.0   HTTP_AP                                                           07/23/2020 20:56:21 PAGE 3   

 117                          <span>SWITCH1:</span>\r\n\
 118                          <button class=\"ss1\" onclick=\"jp('SWITCH1=ON')\">ON</button>\r\n\
 119                          <button class=\"ss2\" onclick=\"jp('SWITCH1=OFF')\">OFF</button>\r\n\
 120                          <br>\r\n\
 121                          <span>SWITCH2:</span>\r\n\
 122                          <button class=\"ss1\" onclick=\"jp('SWITCH2=ON')\">ON</button>\r\n\
 123                          <button class=\"ss2\" onclick=\"jp('SWITCH2=OFF')\">OFF</button><br>\r\n\
 124                          <span>SWITCH3:</span>\r\n\
 125                          <button class=\"ss1\" onclick=\"jp('SWITCH3=ON')\">ON</button>\r\n\
 126                          <button class=\"ss2\" onclick=\"jp('SWITCH3=OFF')\">OFF</button><br>\r\n\
 127                          <span>SWITCH4:</span>\r\n\
 128                          <button class=\"ss1\" onclick=\"jp('SWITCH4=ON')\">ON</button>\r\n\
 129                          <button class=\"ss2\" onclick=\"jp('SWITCH4=OFF')\">OFF</button>\r\n\
 130                      <br>\r\n\
 131                  <br>\r\n\
 132                      <hr>\r\n\
 133                  <br>\r\n\
 134                  <span>LIGHT1:</span>\r\n\
 135                  <button class=\"ss1\" onclick=\"jp('LIGHT1=ON')\">ON</button>\r\n\
 136                  <button class=\"ss3\" onclick=\"jp('LIGHT1=INC')\">ADD</button>\r\n\
 137                  <button class=\"ss4\" onclick=\"jp('LIGHT1=DEC')\">DEC</button>\r\n\
 138                  <button class=\"ss2\" onclick=\"jp('LIGHT1=OFF')\">OFF</button><br>\r\n\
 139                  <span>LIGHT2:</span>\r\n\
 140                  <button class=\"ss1\" onclick=\"jp('LIGHT2=ON')\">ON</button>\r\n\
 141                  <button class=\"ss3\" onclick=\"jp('LIGHT2=INC')\">ADD</button>\r\n\
 142                  <button class=\"ss4\" onclick=\"jp('LIGHT2=ON')\">DEC</button>\r\n\
 143                  <button class=\"ss2\" onclick=\"jp('LIGHT2=DEC')\">OFF</button><br>\r\n\
 144                  <br>\r\n\
 145                      <hr>\r\n\
 146                  <br>\r\n\
 147                  <span>Tempreture: <span id=\"tp\">30 'C</span></span><button class=\"ss5\" onclick=\"jp('REFRESH')
             -\">Refresh</button><br>\r\n\
 148                  <span>Humidity: <span id=\"hu\">70%</span></span><br>\r\n\
 149              </div>\r\n\
 150          </body>\r\n\
 151          </html>";
 152          */
 153          /*
 154          u8 code HTTP_INDEX_CONTENT[]  = "<!DOCTYPE html>\r\n\
 155          <html lang=\"en\">\r\n\
 156          <head>\r\n\
 157              <meta charset=\"UTF-8\">\r\n\
 158              <title>Genius AI Lab</title>\r\n\
 159              <style>\r\n\
 160                  h1{font-size:600%;text-align:center}\r\n\
 161                  .wd{font-size:300%;margin-left:40px}\r\n\
 162                  button{type:submit;margin-left:40px;width:120px;height:120px;border-radius:60px;padding:20px}\r\n\
 163                  .sw1{background:#ff9953;value:ON}\r\n\
 164                  .sw2{background:darkgray;value:OFF}\r\n\
 165              </style>\r\n\
 166          </head>\r\n\
 167          <body>\r\n\
 168              <div style=\"width:1000px\">\r\n\
 169                  <div style=\"background-color:slategray\">\r\n\
 170                      <h1>Genius AI Lab</h1>\r\n\
 171                  </div>\r\n\
 172                  <br>\r\n\
 173                      <form name=\"sw\" action=\"table\" method=\"post\">\r\n\
 174                          <span class=\"wd\">SWITCH1:</span>\r\n\
 175                          <button class=\"sw1\" name=\"SWITCH1\">ON</button>\r\n\
 176                          <button class=\"sw2\" name=\"SWITCH1\">OFF</button>\r\n\
 177                          <br>\r\n\
C51 COMPILER V9.56.0.0   HTTP_AP                                                           07/23/2020 20:56:21 PAGE 4   

 178                          <span class=\"wd\">SWITCH2:</span>\r\n\
 179                          <button class=\"sw1\" name=\"SWITCH2\">ON</button>\r\n\
 180                          <button class=\"sw2\" name=\"SWITCH2\">OFF</button><br>\r\n\
 181                          <span class=\"wd\">SWITCH3:</span>\r\n\
 182                          <button class=\"sw1\" name=\"SWITCH3\">ON</button>\r\n\
 183                          <button class=\"sw2\" name=\"SWITCH3\">OFF</button><br>\r\n\
 184                          <span class=\"wd\">SWITCH4:</span>\r\n\
 185                          <button class=\"sw1\" name=\"SWITCH4\">ON</button>\r\n\
 186                          <button class=\"sw2\" name=\"SWITCH4\">OFF</button>\r\n\
 187                      </form>\r\n\
 188                      <br>\r\n\
 189                      <hr>\r\n\
 190              </div>\r\n\
 191              <br>\r\n\
 192          </body>\r\n\
 193          </html>";
 194          
 195          
 196          
 197          
 198          */
 199          /*
 200          u8 const WIFI_PAGE[]  = "HTTP/1.1 200 OK
 201          Content-Type: text/html
 202          Content-Length:361
 203          
 204          <html>
 205          <body>
 206          <h1>欢迎您使用天才的AI实验设备</h1>
 207          <p>请您输入WIFI名称和密码，通过此WIFI，设备可以连接到天才云。</p>
 208          <form action=\"/wifiset.html\">
 209          WIFI名称:<br>
 210          <input type=\"text\" name=\"firstname\" value=\"Louiswoo\">
 211          <br>
 212          密码:<br>
 213          <input type=\"text\" name=\"lastname\" value=\"Genius\">
 214          <br><br>
 215          <input type=\"submit\" value=\"连接\">
 216          </form>
 217          </body>
 218          </html>";
 219          
 220          u8 const CONNECTED_PAGE[] = "HTTP/1.1 200 OK
 221          Content-Type: text/html
 222          Content-Length:77
 223          
 224          <html>
 225          <body>
 226          <h1>WIFI成功连接，感谢您使用天才云！</h1>
 227          </body>
 228          </html>";
 229          
 230          u8 const PORTAL_PAGE[]  = "HTTP/1.0 200 OK\r\n\
 231          Content-Type: text/html; charset=utf-8\r\n\
 232          Content-Length: 149\r\n\
 233          Server: Werkzeug/1.0.1 Python/3.8.1\r\n\
 234          Date: Tue, 14 Jul 2020 09:12:38 GMT\r\n\
 235          \r\n\
 236          <!DOCTYPE html>\r\n\
 237          <html lang=\"en\">\r\n\
 238          <head>\r\n\
 239              <meta charset=\"UTF-8\">\r\n\
C51 COMPILER V9.56.0.0   HTTP_AP                                                           07/23/2020 20:56:21 PAGE 5   

 240              <title>Geni</title>\r\n\
 241          </head>\r\n\
 242          <body>\r\n\
 243              i am a Genius!!!\r\n\
 244          </body>\r\n\
 245          </html>";
 246          
 247          */


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    269    ----
   CONSTANT SIZE    =   1755    ----
   XDATA SIZE       =   ----       5
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
